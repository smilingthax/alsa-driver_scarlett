--- ../../alsa-kernel/pci/asihpi/hpios.c	2010-04-21 18:36:16.617452068 +0200
+++ hpios.c	2010-04-21 18:40:32.700700812 +0200
@@ -1,3 +1,4 @@
+#include "adriver.h"
 /******************************************************************************
 
     AudioScience HPI driver
@@ -26,6 +27,7 @@
 #include <linux/delay.h>
 #include <linux/sched.h>
 
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(2 , 6 , 14)
 void hpios_delay_micro_seconds(u32 num_micro_sec)
 {
 	if ((usecs_to_jiffies(num_micro_sec) > 1) && !in_interrupt()) {
@@ -38,6 +40,19 @@
 		mdelay(num_micro_sec / 1000);
 
 }
+#else
+void hpios_delay_micro_seconds(u32 num_micro_sec)
+{
+	if ((num_micro_sec / 1000 >= 1000000 / HZ) && !in_interrupt()) {
+		set_current_state(TASK_UNINTERRUPTIBLE);
+		schedule_timeout((HZ * num_micro_sec + (HZ - 1)) / 1000000);
+	} else if (num_micro_sec <= 2000)
+		udelay(num_micro_sec);
+	else
+		mdelay(num_micro_sec / 1000);
+
+}
+#endif
 
 void hpios_locked_mem_init(void)
 {
