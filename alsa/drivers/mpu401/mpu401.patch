--- ../../alsa-kernel/drivers/mpu401/mpu401.c	Mon Oct 25 21:51:21 2004
+++ mpu401.c	Mon Oct 25 22:09:29 2004
@@ -51,6 +51,9 @@
 #endif
 static long port[SNDRV_CARDS] = SNDRV_DEFAULT_PORT;	/* MPU-401 port number */
 static int irq[SNDRV_CARDS] = SNDRV_DEFAULT_IRQ;	/* MPU-401 IRQ */
+#ifdef CONFIG_X86_PC9800
+static int pc98ii[SNDRV_CARDS];				/* PC98-II dauther board */
+#endif
 
 module_param_array(index, int, NULL, 0444);
 MODULE_PARM_DESC(index, "Index value for MPU-401 device.");
@@ -66,6 +69,10 @@
 MODULE_PARM_DESC(port, "Port # for MPU-401 device.");
 module_param_array(irq, int, NULL, 0444);
 MODULE_PARM_DESC(irq, "IRQ # for MPU-401 device.");
+#ifdef CONFIG_X86_PC9800
+module_param_array(pc98ii, bool, boot_devs, 0444);
+MODULE_PARM_DESC(pc98ii, "Roland MPU-PC98II support.");
+#endif
 
 #ifndef CONFIG_ACPI_BUS
 struct acpi_device;
@@ -90,9 +97,19 @@
 
 	if (res->id == ACPI_RSTYPE_IRQ) {
 		if (res->data.irq.number_of_interrupts > 0) {
+#ifdef CONFIG_HAVE_ACPI_REGISTER_GSI
 			resources->irq = acpi_register_gsi(res->data.irq.interrupts[0],
 							   res->data.irq.edge_level,
 							   res->data.irq.active_high_low);
+#else
+#ifdef CONFIG_IA64
+			resources->irq = acpi_register_irq(res->data.irq.interrupts[0],
+							   res->data.irq.active_high_low,
+							   res->data.irq.edge_level);
+#else
+			resources->irq = res->data.irq.interrupts[0];
+#endif
+#endif
 		}
 	} else if (res->id == ACPI_RSTYPE_IO) {
 		if (res->data.io.range_length >= 2) {
@@ -168,6 +185,9 @@
 	}
 #endif
 	if (snd_mpu401_uart_new(card, 0,
+#ifdef CONFIG_X86_PC9800
+				pc98ii[dev] ? MPU401_HW_PC98II :
+#endif
 				MPU401_HW_MPU401,
 				port[dev], 0,
 				irq[dev], irq[dev] >= 0 ? SA_INTERRUPT : 0, NULL) < 0) {
@@ -281,3 +301,5 @@
 
 module_init(alsa_card_mpu401_init)
 module_exit(alsa_card_mpu401_exit)
+
+EXPORT_NO_SYMBOLS;
