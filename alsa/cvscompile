#!/bin/bash

if [ -r /usr/share/aclocal/alsa-lib.m4 ]; then
  rm -f /usr/share/aclocal/alsa-lib.m4
fi
if [ -r /usr/local/share/aclocal/alsa-lib.m4 ]; then
  rm -f /usr/local/share/aclocal/alsa-lib.m4
fi
if [ -d ../alsa-lib ]; then
  echo "Building hard symlinks with alsa-lib sources..."
  cd kernel
  pwd
  ln -fv ../../alsa-lib/src/pcm/pcm_misc.c .
  cd oss
  ln -fv ../../../alsa-lib/src/pcm/pcm_common.c .
  pwd
  for f in block.c copy.c linear.c mulaw.c rate.c route.c plugin_ops.h
  do
    ln -fv ../../../alsa-lib/src/pcm/plugin/$f $f
  done
  cd ../..
fi
aclocal $ACLOCAL_FLAGS
autoconf
if [ $# -eq 0 ]; then
  echo "./configure --with-debug=full --with-isapnp=yes --with-sequencer=yes"
  ./configure --with-debug=full --with-isapnp=yes --with-sequencer=yes || exit 1
else
  echo "./configure $@"
  ./configure $@ || exit 1
fi
make dep
make
